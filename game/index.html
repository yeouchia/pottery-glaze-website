<!-- 
Lineage M v77.125 (Tier Borders)
----------------------------------------
[ç‰ˆæœ¬è³‡è¨Š]
* Core: v77.103 (Def Fix)
* UI: v77.104 (Tier Borders)
----------------------------------------
[æ›´æ–°è¨˜éŒ„ - v77.104_TierBorders]
* 1. [CSS] æ–°å¢ .tier-* ç³»åˆ—æ¨£å¼ï¼Œå®šç¾© 6 ç¨®éšç´šçš„é‚Šæ¡†é¡è‰²èˆ‡å…‰æšˆã€‚
* - ç™½/é»ƒ/ç¶ /è—/ç´…/ç´«ï¼Œå°æ‡‰ data.js ä¸­çš„å¥—è£è¨­å®šã€‚
----------------------------------------
-->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lineage M v77.125: Pottery Edition</title>
    <!-- å¼•å…¥ FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Noto+Serif+TC:wght@500;900&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; background: #050505; color: #ddd; font-family: 'Noto Serif TC', serif; overflow: hidden; touch-action: none; user-select: none; -webkit-user-select: none; }
        canvas { display: block; width: 100%; height: 100%; image-rendering: pixelated; cursor: default; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .glass-panel { background: rgba(20, 24, 28, 0.95); border: 1px solid #6b5b4b; border-top: 3px solid #9c7c5b; box-shadow: 0 10px 60px rgba(0,0,0,1), inset 0 0 50px rgba(0,0,0,0.9); color: #eec; border-radius: 4px; pointer-events: auto; }
        .glass-btn { background: linear-gradient(180deg, #444455, #222233); border: 1px solid #776655; color: #ddccaa; padding: 4px 10px; border-radius: 3px; font-size: 12px; pointer-events: auto; cursor: pointer; box-shadow: 0 3px 5px rgba(0,0,0,0.5); font-weight: bold; font-family: 'Noto Serif TC', serif; transition: all 0.1s; text-shadow: 1px 1px 0 #000; }
        .glass-btn:active { transform: translateY(2px); filter: brightness(0.8); }
        .btn-buy-10 { border-color: #468; color: #adf; margin-left: 2px; background: linear-gradient(180deg, #223344, #112233); }
        .btn-plus { border-color: #2a2; color: #4f4; padding: 2px 6px; margin-left:5px; font-size:10px; }
        #btn-auto { width: 80px; border-color: #4a4; color: #4f4; text-shadow: 0 0 5px #0f0; }
        #btn-auto.off { background: linear-gradient(180deg, #333, #222); border-color: #666; color: #888; text-shadow: none; }
        .enchant-target { animation: pulse 0.3s infinite alternate; border-color: #0f0 !important; cursor: pointer; background: rgba(0,50,0,0.5); }
        @keyframes pulse { from { box-shadow: 0 0 5px #0f0; } to { box-shadow: 0 0 20px #0f0; } }
        .window { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 380px; max-height: 580px; display: none; flex-direction: column; z-index: 1000; }
        .win-head { padding: 10px 15px; background: linear-gradient(90deg, #2b2015, #4e3828, #2b2015); border-bottom: 1px solid #765; color: #ffcc66; font-weight: bold; letter-spacing: 1px; display: flex; justify-content: space-between; align-items: center; text-shadow: 0 2px 4px #000; font-family: 'Cinzel', serif; font-size: 15px; }
        .win-body { padding: 10px; overflow-y: auto; flex-grow: 1; scrollbar-width: thin; scrollbar-color: #654 #111; }
        .win-close { cursor: pointer; color: #e55; font-size: 20px; font-weight: bold;}
        
        /* Paper Doll (Character Equip Slots) */
        .paper-doll { position: relative; width: 240px; height: 280px; margin: 0 auto 5px auto; background: #080808; border: 2px solid #443; border-radius: 8px; background-image: radial-gradient(circle at 50% 20%, #222 15px, transparent 16px), linear-gradient(to bottom, transparent 60px, #222 60px, #222 160px, transparent 160px), linear-gradient(to bottom, transparent 60px, #222 60px, #222 140px, transparent 140px); background-repeat: no-repeat; background-size: 100% 100%, 60px 100%, 140px 100%; background-position: center top, center top, center top; }
        .pd-slot { position: absolute; width: 42px; height: 42px; background: rgba(0,0,0,0.6); border: 1px solid #554; border-radius: 4px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 24px; color: #444; cursor: pointer; box-shadow: inset 0 0 10px #000; overflow: hidden; }
        .pd-slot.filled { border-color: #aa8; color: #fff; background: rgba(50,50,60,0.8); }
        .pd-lbl { position: absolute; bottom: 0; left: 0; width: 100%; text-align: center; font-size: 10px; color: #887; background: rgba(0,0,0,0.7); padding: 1px 0; white-space: nowrap; pointer-events: none; z-index: 5; }
        .pd-slot.filled .pd-lbl { color: #0f0; text-shadow: 1px 1px 0 #000; }
        #slot-helm { top: 10px; left: 100px; } #slot-neck { top: 55px; left: 100px; } #slot-shirt { top: 55px; left: 150px; } #slot-armor { top: 100px; left: 100px; width: 40px; height: 60px; } #slot-cloak { top: 100px; left: 50px; width: 40px; height: 60px; } #slot-weapon { top: 100px; left: 150px; width: 40px; height: 60px; } #slot-glove { top: 170px; left: 40px; } #slot-boot { top: 220px; left: 100px; }
        
        #game-ui { display: none; width: 100%; height: 100%; pointer-events: none; }
        #hud-top-left { position: absolute; top: 15px; left: 15px; display: flex; gap: 6px; pointer-events: auto; align-items: center; }
        #hud-stats { font-weight: bold; text-shadow: 1px 1px 0 #000; background: rgba(0,0,0,0.5); padding: 2px 5px; border-radius: 3px; }
        #ui-map-name { position: absolute; top: 30px; left: 50%; transform: translateX(-50%); color: #eee; font-family: 'Noto Serif TC'; font-size: 18px; font-weight: bold; text-shadow: 0 0 5px rgba(0,0,0,1); background: linear-gradient(90deg, transparent, rgba(0,0,0,0.7), transparent); padding: 4px 60px; pointer-events: none; border-top: 1px solid rgba(255,255,255,0.1); border-bottom: 1px solid rgba(255,255,255,0.1); }
        #minimap-group { position: absolute; top: 15px; right: 15px; pointer-events: auto; }
        #minimap-con { width: 130px; height: 130px; background: #000; border: 3px double #765; border-radius: 50%; overflow: hidden; box-shadow: 0 5px 15px #000; position: relative; }
        #btn-map-m { position: absolute; bottom: 0px; right: 100px; width: 28px; height: 28px; background: #222; border: 1px solid #ba8; color: #ba8; font-weight: bold; border-radius: 50%; text-align: center; line-height: 26px; cursor: pointer; box-shadow: 0 0 10px #000; pointer-events: auto; z-index: 50; }
        #hud-bottom { position: absolute; bottom: 0; left: 0; width: 100%; height: 140px; background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, transparent 100%); pointer-events: none; }
        
        /* Status Bars */
        #status-bars { position: absolute; bottom: 20px; left: 20px; width: 220px; pointer-events: auto; }
        .bar-frame { padding: 2px; background: #0c0c0c; border: 1px solid #333; margin-bottom: 5px; position: relative; box-shadow: 0 2px 5px #000; transform: skewX(-10deg); }
        .bar-fill { height: 10px; width: 0%; transition: width 0.2s; position: relative; overflow: hidden; }
        .hp { background: linear-gradient(90deg, #600, #c00, #f44); } .mp { background: linear-gradient(90deg, #004, #008, #37f); } .exp-bar { background: linear-gradient(90deg, #040, #080, #0f0); }
        .bar-text { position: absolute; top: -2px; width: 100%; text-align: center; font-size: 10px; color: #fff; transform: skewX(10deg); text-shadow: 1px 1px 0 #000; pointer-events: none; font-weight: bold; z-index: 2; }
        
        #buff-bar { position: absolute; top: -45px; left: 0; display: flex; gap: 5px; pointer-events: none;}
        .buff-icon { width: 44px; height: 34px; background: rgba(0,0,0,0.6); border: 1px solid #665; border-radius: 4px; font-size: 11px; color: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2px 0; margin-right: 4px; }
        .buff-name { font-size: 10px; line-height: 12px; font-weight: bold; } .buff-time { font-size: 9px; color: #0f0; line-height: 12px; }
        
        /* Hotkeys */
        #hotkeys { position: absolute; bottom: 20px; left: 260px; display: flex; gap: 4px; pointer-events: auto; }
        .key-slot { width: 36px; height: 36px; background: rgba(20,20,25,0.9); border: 1px solid #555; border-radius: 4px; position: relative; display: flex; align-items: center; justify-content: center; font-size: 16px; cursor: pointer; box-shadow: inset 0 0 10px #000; }
        .key-slot:active { border-color: #fca; transform: scale(0.95); }
        .key-lbl { position: absolute; top: -14px; left: 50%; transform: translateX(-50%); font-size: 9px; color: #aaa; font-weight: bold; }
        .key-qty { position: absolute; bottom: 0px; right: 1px; font-size: 9px; color: #fff; text-shadow: 1px 1px 0 #000; font-weight: bold; }
        
        #msg-log { position: absolute; bottom: 20px; right: 20px; width: 360px; height: 140px; background: rgba(0,0,0,0.6); border: 1px solid #444; border-radius: 4px; overflow: hidden; pointer-events: none; display: flex; flex-direction: column; justify-content: flex-end; padding: 8px; font-size: 13px; text-shadow: 1px 1px 0 #000; mask-image: linear-gradient(to top, rgba(0,0,0,1) 80%, rgba(0,0,0,0) 100%); }
        
        #start-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #050505; z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; pointer-events: auto; background-image: radial-gradient(circle at 50% 40%, #1a1a20 0%, #000 100%); }
        .login-box { background: rgba(20,20,25,0.9); border: 2px solid #554; padding: 30px; border-radius: 8px; text-align: center; box-shadow: 0 0 50px #000; margin-bottom: 20px; width: 300px; }
        .login-input { background: #000; border: 1px solid #443; color: #da0; padding: 10px; font-size: 16px; width: 90%; text-align: center; font-family: 'Cinzel'; margin-bottom: 10px; display: block; margin-left: auto; margin-right: auto; }
        
        /* [New] Pottery Intro Widget Styles */
        #pottery-intro {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 280px;
            z-index: 2001; /* Higher than start screen bg but lower than GM console */
            text-align: left;
        }
        .intro-card {
            background: rgba(20, 24, 28, 0.85);
            border: 1px solid #6b5b4b;
            border-left: 3px solid #fca311; /* Orange accent from welcome.html */
            border-radius: 4px;
            padding: 15px;
            color: #ddd;
            box-shadow: 0 5px 20px rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
        }
        .intro-title {
            color: #fca311;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            border-bottom: 1px solid #444;
            padding-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .intro-link-btn {
            display: block;
            width: 100%;
            padding: 8px 0;
            background: linear-gradient(90deg, #9d4edd, #5a189a); /* Purple accent */
            color: #fff;
            text-align: center;
            text-decoration: none;
            border: 1px solid #c77dff;
            border-radius: 3px;
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 10px;
            box-shadow: 0 0 10px rgba(157, 78, 221, 0.3);
            transition: all 0.2s;
            box-sizing: border-box;
        }
        .intro-link-btn:hover {
            filter: brightness(1.2);
            transform: translateY(-1px);
            box-shadow: 0 0 15px rgba(157, 78, 221, 0.5);
        }
        .intro-list {
            list-style: none;
            padding: 0;
            margin: 0;
            font-size: 11px;
            color: #aaa;
        }
        .intro-list li {
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .intro-list i {
            width: 16px;
            text-align: center;
        }
        /* Icon colors to match welcome.html themes */
        .ic-calc { color: #fca311; }
        .ic-video { color: #ff4444; }
        .ic-life { color: #9d4edd; }
        .ic-game { color: #4caf50; }

        /* [Updated] Inv/Shop Info Box - Auto Height */
        #inv-info, #shop-info { 
            background: #111; color: #888; padding: 8px; font-size: 11px; font-weight: bold; 
            border-top: 1px solid #444; 
            min-height: 35px; height: auto; /* Changed from fixed height */
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            text-align: center; line-height: 1.4;
            text-shadow: 0 0 5px rgba(0,0,0,0.8); letter-spacing: 1px; 
        }
        .item-row { display: flex; justify-content: space-between; padding: 6px; border-bottom: 1px solid #333; align-items: center; background: rgba(0,0,0,0.2); }
        .item-icon { width: 28px; height: 28px; background: #111; border: 1px solid #444; margin-right: 8px; border-radius: 2px; display:flex; align-items:center; justify-content:center; font-size:16px; cursor: pointer; flex-shrink: 0;}
        .item-icon:hover { border-color: #d4af37; box-shadow: 0 0 5px #d4af37; }
        
        /* [New] éšç´šé‚Šæ¡†æ¨£å¼ (Tier Borders) */
        .item-icon.tier-white { border: 1px solid #ccc; box-shadow: 0 0 2px #fff; }
        .item-icon.tier-yellow { border: 1px solid #ffd700; box-shadow: 0 0 4px #ffd700; }
        .item-icon.tier-green { border: 1px solid #0f0; box-shadow: 0 0 4px #0f0; }
        .item-icon.tier-blue { border: 1px solid #0bf; box-shadow: 0 0 4px #0bf; }
        .item-icon.tier-red { border: 1px solid #f44; box-shadow: 0 0 4px #f00; }
        .item-icon.tier-purple { border: 1px solid #d0f; box-shadow: 0 0 6px #d0f; }

        #joy-zone { position: absolute; bottom: 40px; left: 30px; width: 100px; height: 100px; pointer-events: auto; opacity: 0.5; }
        #joy-base { width: 100%; height: 100%; border: 2px solid #555; border-radius: 50%; }
        #joy-stick { width: 40px; height: 40px; background: #888; border-radius: 50%; position: absolute; top: 30px; left: 30px; }
        
        #teleport-menu { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 320px; display: none; z-index: 2000; text-align: center; }
        #win-map { width: 640px !important; height: 680px !important; }
        #map-container { width: 600px !important; height: 600px !important; }
        
        #asset-btn { display:block; width:80%; margin:10px auto; padding:15px; background: linear-gradient(180deg, #464, #242); border:1px solid #6a6; color:#cfc; font-weight:bold; cursor:pointer; }
        #asset-status { font-size:12px; color:#888; text-align:center; margin-top:5px; }
        .as-cb { transform: scale(1.5); cursor: pointer; }
        
        #win-stats .win-body { padding: 5px; }
        #st-summary { display:flex; justify-content:space-around; margin:5px 0; background:#111; padding:3px; border-radius:4px; font-size: 11px; }
        #st-summary span { display: inline-flex; align-items: center; gap: 4px; }
        #st-points-row { text-align:center; color:#ff0; margin-bottom:5px; font-size: 11px; }
        .st-attr-row { display: flex; justify-content: space-between; padding: 3px 8px; border-bottom: 1px solid #333; align-items: center; background: rgba(0,0,0,0.2); font-size: 11px; }
        .st-attr-row button { transform: scale(0.9); }
    </style>
</head>
<body>
<canvas id="cvs"></canvas>
<div id="ui-layer">
    <!-- Start Screen -->
    <div id="start-screen">
        
        <!-- [New] Pottery Website Intro Widget -->
        <div id="pottery-intro">
            <div class="intro-card">
                <div class="intro-title">
                    <i class="fa-solid fa-flask"></i> é™¶è—èˆ‡é‡‰è—¥èª¿é…
                </div>
                <div style="font-size:11px; color:#999; margin-bottom:10px; line-height:1.4;">
                    èåˆç§‘å­¸è¨ˆç®—èˆ‡è—è¡“å‰µä½œçš„é™¶è—å­¸ç¿’ä¸­å¿ƒã€‚ç²¾æº–é…æ–¹ã€æ­·å²æ–‡åŒ–èˆ‡ç”Ÿæ´»ç¾å­¸ã€‚
                </div>
                <a href="https://yeouchia.github.io/pottery-glaze-website/" target="_blank" class="intro-link-btn">
                    <i class="fa-solid fa-arrow-up-right-from-square"></i> å‰å¾€é™¶è—ä¸­å¿ƒ
                </a>
                <ul class="intro-list">
                    <li><i class="fa-solid fa-calculator ic-calc"></i> <span>ç²¾æº–é‡‰è—¥è¨ˆç®— (ç§‘å­¸èª¿é…)</span></li>
                    <li><i class="fa-brands fa-youtube ic-video"></i> <span>è±å¯Œå½±éŸ³èª²ç¨‹ (ç·šä¸Šæ•™å­¸)</span></li>
                    <li><i class="fa-solid fa-heart ic-life"></i> <span>é™¶è—ç”Ÿæ´» (FB/IG/å±•è¦½)</span></li>
                    <li><i class="fa-solid fa-gamepad ic-game"></i> <span>èª²å¾Œç´“å£“å¤©åœ° (æœ¬éŠæˆ²)</span></li>
                </ul>
            </div>
        </div>

        <h1 style="color:#d9a040; font-family:'Cinzel'; margin-bottom:5px; font-size:48px; text-shadow:0 0 20px #a60; letter-spacing: 4px;">LINEAGE M</h1>
        <p style="color:#666; font-size:12px; margin-bottom:20px; letter-spacing: 4px;">v77.104 TIER UI EDITION</p>
        <div id="login-box-main" class="login-box">
            <div style="color:#888; font-size:12px; margin-bottom:5px;">å¸³è™Ÿ (ID)</div>
            <input type="text" id="login-id" class="login-input" placeholder="User ID">
            <div style="color:#888; font-size:12px; margin-bottom:5px;">å¯†ç¢¼ (Password)</div>
            <input type="password" id="login-pw" class="login-input" placeholder="Password">
            <button class="glass-btn" style="width:100%; border-color:#d44; color:#f88; margin-top:5px;" onclick="deleteAccountData()">âš  åˆªé™¤å¸³è™Ÿè³‡æ–™</button>
            <div style="border-top:1px solid #444; margin:15px 0; padding-top:15px;">
                <button id="asset-btn" onclick="document.getElementById('folder-input').click()">ğŸ“‚ è¼‰å…¥åœ–æª”è³‡æ–™å¤¾ (é¸ç”¨)</button>
                <input type="file" id="folder-input" webkitdirectory directory multiple style="display:none" onchange="loadAssets(this)">
                <div id="asset-status">é è¨­ä½¿ç”¨å…§å»ºé«˜ç•«è³ª SVG (150x150)</div>
            </div>
            <div style="font-size:10px; color:#555; margin-top:10px;">(ç³»çµ±è‡ªå‹•å„²å­˜é€²åº¦)</div>
        </div>
        <div style="display:flex; gap:20px; margin-top:20px;">
            <div onclick="loginAndStart('knight')" style="cursor:pointer; text-align:center; opacity:0.8; transition:0.2s;" onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0.8"><div style="font-size:40px; color:#ddd; margin-bottom:5px;">ğŸ›¡ï¸</div><div style="color:#d4af37; font-weight:bold;">é¨å£«</div></div>
            <div onclick="loginAndStart('elf')" style="cursor:pointer; text-align:center; opacity:0.8; transition:0.2s;" onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0.8"><div style="font-size:40px; color:#adff2f; margin-bottom:5px;">ğŸ¹</div><div style="color:#d4af37; font-weight:bold;">å¦–ç²¾</div></div>
            <div onclick="loginAndStart('mage')" style="cursor:pointer; text-align:center; opacity:0.8; transition:0.2s;" onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0.8"><div style="font-size:40px; color:#87ceeb; margin-bottom:5px;">ğŸ”®</div><div style="color:#d4af37; font-weight:bold;">æ³•å¸«</div></div>
        </div>
        <br>
        <label for="bgm-input" class="glass-btn">ğŸ“‚ è¼‰å…¥ BGM (MP3)</label>
        <input type="file" id="bgm-input" accept="audio/*" style="display:none">
    </div>

    <!-- GM Console (Restored Full Version) -->
    <div id="gm-console" class="window glass-panel" style="width:320px; z-index:3000; display:none; top:50%; left:50%; transform:translate(-50%, -50%);">
        <div class="win-head" style="background: linear-gradient(90deg, #400, #800, #400);"><span>ğŸ‘‘ GM ç®¡ç†å“¡æ§åˆ¶å°</span></div>
        <div class="win-body" style="padding:20px;">
            <div style="margin-bottom:15px;">
                <div style="color:#ff0; font-size:12px; margin-bottom:5px;">EXP å€ç‡ (ç¶“é©—å€¼)</div>
                <select id="gm-exp" style="width:100%; background:#222; color:#fff; padding:5px;">
                    <option value="1">æ­£å¸¸ (1x)</option><option value="100">é«˜å€ç‡ (100x)</option><option value="500">è¶…é«˜å€ç‡ (500x)</option>
                    <option value="1000">è®Šæ…‹å€ç‡ (1000x)</option><option value="2000">ç¥ä¹‹é ˜åŸŸ (2000x)</option><option value="4000">ä¸€åˆ€æ»¿ç­‰ (4000x)</option>
                    <option value="8000">å…‰é€Ÿå‡ç´š (8000x)</option>
                    <option value="50000">GM æ¸¬è©¦ (50000x)</option>
                </select>
            </div>
            <div style="margin-bottom:15px;">
                <div style="color:#fd0; font-size:12px; margin-bottom:5px;">Gold å€ç‡ (é‡‘å¹£)</div>
                <select id="gm-gold" style="width:100%; background:#222; color:#fff; padding:5px;">
                    <option value="1">æ­£å¸¸ (1x)</option><option value="10">å¯Œè£• (10x)</option><option value="100">è²¡å¯Œè‡ªç”± (100x)</option><option value="1000">éŒ¢æ·¹è…³ç›® (1000x)</option>
                </select>
            </div>
            <div style="margin-bottom:15px;">
                <div style="color:#f88; font-size:12px; margin-bottom:5px;">Mob å€ç‡ (æ€ªç‰©æ•¸é‡)</div>
                <select id="gm-spawn" style="width:100%; background:#222; color:#fff; padding:5px;">
                    <option value="1">æ­£å¸¸ (1x)</option><option value="2">å¤š (2x)</option><option value="3">å¾ˆå¤š (3x)</option>
                    <option value="4">æ€ªç‰©æµ· (4x)</option><option value="8">æ€ªç‰©æ´—å± (8x)</option>
                    <option value="12">æœ«æ—¥ç´š (12x)</option>
                    <option value="20">å£“åŠ›æ¸¬è©¦ (20x)</option>
                </select>
            </div>
            <div style="margin-bottom:15px; border-top:1px dashed #666; padding-top:10px;">
                <div style="color:#0f0; font-size:12px; margin-bottom:5px;">Drop (æ¶ˆè€—å“)</div>
                <select id="gm-drop-use" style="width:100%; background:#222; color:#fff; padding:2px;"><option value="1">1x</option><option value="5">5x</option><option value="10">10x</option></select>
                <div style="color:#aaf; font-size:12px; margin-bottom:5px; margin-top:5px;">Drop (ä¸€èˆ¬è£å‚™)</div>
                <select id="gm-drop-equip" style="width:100%; background:#222; color:#fff; padding:2px;"><option value="1">1x</option><option value="10">10x</option><option value="100">100x</option></select>
                <div style="color:#f0f; font-size:12px; margin-bottom:5px; margin-top:5px;">Drop (é«˜ç´š/ç¨€æœ‰)</div>
                <select id="gm-drop-rare" style="width:100%; background:#222; color:#fff; padding:2px;"><option value="1">1x</option><option value="50">50x</option><option value="500">500x (å¿…æ‰)</option></select>
            </div>
            <button class="glass-btn" style="width:100%; padding:10px; border-color:#f00; color:#fff; font-weight:bold; background:#500;" onclick="applyGMSettings()">ç¢ºèªä¸¦ç”Ÿæ•ˆ</button>
            <div style="text-align:center; font-size:10px; color:#888; margin-top:10px;">è¨­å®šå¾Œè«‹æ”¹å›æ­£å¸¸å¸³è™Ÿç™»å…¥éŠæˆ²</div>
        </div>
    </div>

    <!-- Main Game HUD -->
    <div id="game-ui">
        <div id="ui-map-name">èªªè©±ä¹‹å³¶</div>
        <div id="hud-top-left">
            <button class="glass-btn" onclick="toggleAutoCombat()" id="btn-auto">è‡ªå‹•: ON</button>
            <button class="glass-btn" onclick="toggleWin('guide')" style="border-color:#da0; color:#ffc;">ğŸ“– æŒ‡å—</button>
            <button class="glass-btn" onclick="toggleWin('stats')">ç‹€æ…‹</button>
            <button class="glass-btn" onclick="toggleWin('skills')">æŠ€èƒ½</button>
            <button class="glass-btn" onclick="toggleWin('inv')">èƒŒåŒ…</button>
            <button class="glass-btn" onclick="toggleWin('shop')">å•†åº—</button>
            <button class="glass-btn" onclick="toggleWin('settings')">è¨­å®š</button>
        </div>
        <div style="position:absolute; top:15px; right:160px; pointer-events:auto;"><button class="glass-btn" style="border-color:#844; color:#fcc;" onclick="saveAndLogout()">ç™»å‡º</button></div>
        <div id="minimap-group">
            <div id="minimap-con"><canvas id="mm-cvs" width="130" height="130"></canvas></div>
            <div id="btn-map-m" onclick="toggleWin('map')">M</div>
        </div>
        <div id="hud-bottom">
            <div id="status-bars">
                <div class="lvl-badge" style="margin-bottom:2px;">Lv.<span id="ui-lvl">1</span> <span style="font-size:12px; color:#aaa" id="ui-class"></span></div>
                <div class="bar-frame" style="height:6px; margin-bottom:5px; border-color:#444; background:#000;"><div class="bar-fill exp-bar" id="bar-exp" style="width:0%"></div></div>
                <div id="buff-bar"></div>
                <div class="bar-frame"><div class="bar-fill hp" id="bar-hp" style="width:100%"></div><div class="bar-text" id="txt-hp"></div></div>
                <div class="bar-frame"><div class="bar-fill mp" id="bar-mp" style="width:100%"></div><div class="bar-text" id="txt-mp"></div></div>
                <div style="font-size:12px; color:#ffd700; text-align:right; margin-top:2px;">ğŸ’° <span id="ui-gold">0</span></div>
            </div>
            <div id="hotkeys">
                <div class="key-slot" onclick="assignHotkey(0)"><div class="key-lbl">1</div><div class="key-icon" id="hk-0"></div><div class="key-qty" id="qt-0"></div></div>
                <div class="key-slot" onclick="assignHotkey(1)"><div class="key-lbl">2</div><div class="key-icon" id="hk-1"></div><div class="key-qty" id="qt-1"></div></div>
                <div class="key-slot" onclick="assignHotkey(2)"><div class="key-lbl">3</div><div class="key-icon" id="hk-2"></div><div class="key-qty" id="qt-2"></div></div>
                <div class="key-slot" onclick="assignHotkey(3)"><div class="key-lbl">4</div><div class="key-icon" id="hk-3"></div><div class="key-qty" id="qt-3"></div></div>
                <div class="key-slot" onclick="assignHotkey(4)"><div class="key-lbl">5</div><div class="key-icon" id="hk-4"></div><div class="key-qty" id="qt-4"></div></div>
                <div class="key-slot" onclick="assignHotkey(5)"><div class="key-lbl">6</div><div class="key-icon" id="hk-5"></div><div class="key-qty" id="qt-5"></div></div>
                <div class="key-slot" onclick="assignHotkey(6)"><div class="key-lbl">7</div><div class="key-icon" id="hk-6"></div><div class="key-qty" id="qt-6"></div></div>
                <div class="key-slot" onclick="assignHotkey(7)"><div class="key-lbl">8</div><div class="key-icon" id="hk-7"></div><div class="key-qty" id="qt-7"></div></div>
                <div class="key-slot" onclick="assignHotkey(8)"><div class="key-lbl">9</div><div class="key-icon" id="hk-8"></div><div class="key-qty" id="qt-8"></div></div>
                <div class="key-slot" onclick="assignHotkey(9)"><div class="key-lbl">0</div><div class="key-icon" id="hk-9"></div><div class="key-qty" id="qt-9"></div></div>
            </div>
            <div id="msg-log"></div>
        </div>
        <div id="joy-zone"><div id="joy-base"><div id="joy-stick"></div></div></div>
    </div>

    <!-- Windows (Popups) -->
    <div id="win-guide" class="window glass-panel" style="width:400px; height:500px;">
        <div class="win-head"><span>ğŸ“– å†’éšªæŒ‡å— (Game Guide)</span><span class="win-close" onclick="toggleWin('guide')">âœ•</span></div>
        <div class="win-body" id="guide-content"></div>
    </div>
    <div id="win-inv" class="window glass-panel">
        <div class="win-head"><span id="inv-title">èƒŒåŒ… (Inventory)</span><span class="win-close" onclick="toggleWin('inv')">âœ•</span></div>
        <div class="win-body" id="inv-list"></div>
        <div id="inv-info">é»æ“Šåœ–ç¤ºæŸ¥çœ‹è³‡è¨Š</div>
    </div>
    <div id="win-shop" class="window glass-panel">
        <div class="win-head"><span>å•†åº— (Merchant)</span><span class="win-close" onclick="toggleWin('shop')">âœ•</span></div>
        <div class="tab-bar" style="display:flex; justify-content:center; margin-top:5px;">
            <button class="glass-btn" onclick="setShopTab('buy')" style="width:45%; margin-right:5px;">è³¼è²·</button>
            <button class="glass-btn" onclick="setShopTab('sell')" style="width:45%;">è²©è³£</button>
        </div>
        <div class="win-body" id="shop-list"></div>
        <div id="shop-info">é»æ“Šå•†å“æŸ¥çœ‹èªªæ˜</div>
        <div style="padding:8px; text-align:center; color:#ffd700;">æŒæœ‰é‡‘å¹£: <span id="shop-gold">0</span></div>
    </div>
    <div id="win-stats" class="window glass-panel" style="width:360px;">
        <div class="win-head"><span>è§’è‰²è³‡è¨Š (Status)</span><span class="win-close" onclick="toggleWin('stats')">âœ•</span></div>
        <div class="win-body">
            <div class="paper-doll">
                <div class="pd-slot" id="slot-helm" onclick="unequip('helm')"><div class="pd-lbl">é ­ç›”</div></div>
                <div class="pd-slot" id="slot-neck" onclick="unequip('neck')"><div class="pd-lbl">é …éŠ</div></div>
                <div class="pd-slot" id="slot-shirt" onclick="unequip('shirt')"><div class="pd-lbl">å…§è¡£</div></div>
                <div class="pd-slot" id="slot-armor" onclick="unequip('armor')"><div class="pd-lbl">ç›”ç”²</div></div>
                <div class="pd-slot" id="slot-cloak" onclick="unequip('cloak')"><div class="pd-lbl">æ–—ç¯·</div></div>
                <div class="pd-slot" id="slot-weapon" onclick="unequip('weapon')"><div class="pd-lbl">æ­¦å™¨</div></div>
                <div class="pd-slot" id="slot-glove" onclick="unequip('glove')"><div class="pd-lbl">æ‰‹å¥—</div></div>
                <div class="pd-slot" id="slot-boot" onclick="unequip('boot')"><div class="pd-lbl">é´å­</div></div>
            </div>
            <div id="st-summary"><span>âš”ï¸ <span id="st-atk" style="color:#fff">0</span></span><span>ğŸ›¡ï¸ <span id="st-def" style="color:#fff">0</span></span></div>
            <div id="st-points-row">å‰©é¤˜é»æ•¸: <span id="st-pts">0</span></div>
            <div class="st-attr-row"><span>STR (è¿‘æˆ°å‚·å®³)</span><span><span id="st-str"></span> <button class="glass-btn" onclick="addStat('str')">+</button></span></div>
            <div class="st-attr-row"><span>DEX (é˜²ç¦¦/é æ”»)</span><span><span id="st-dex"></span> <button class="glass-btn" onclick="addStat('dex')">+</button></span></div>
            <div class="st-attr-row"><span>CON (è¡€é‡æˆé•·/å›è¡€)</span><span><span id="st-con"></span> <button class="glass-btn" onclick="addStat('con')">+</button></span></div>
            <div class="st-attr-row"><span>INT (é­”æ³•å‚·å®³/å›é­”)</span><span><span id="st-int"></span> <button class="glass-btn" onclick="addStat('int')">+</button></span></div>
        </div>
    </div>
    <div id="win-skills" class="window glass-panel" style="width:360px;">
        <div class="win-head"><span>æŠ€èƒ½ (Skills)</span><span class="win-close" onclick="toggleWin('skills')">âœ•</span></div>
        <div class="win-body">
            <div style="margin-top:5px; text-align:center; padding-top:5px; color:#0ff; border-bottom: 1px solid #444; margin-bottom:10px;">æŠ€èƒ½é»æ•¸ (SP): <span id="sp-pts">0</span></div>
            <div id="skill-tree-list"></div>
        </div>
    </div>
    <div id="win-settings" class="window glass-panel">
        <div class="win-head"><span>è¨­å®š (Settings)</span><span class="win-close" onclick="toggleWin('settings')">âœ•</span></div>
        <div class="win-body">
            <label for="bgm-input-2" class="glass-btn" style="display:block; text-align:center; margin-bottom:10px;">ğŸ“‚ è¼‰å…¥èƒŒæ™¯éŸ³æ¨‚</label>
            <input type="file" id="bgm-input-2" accept="audio/*" style="display:none" onchange="loadBgm(this)">
            <div style="margin:10px 0;">HPå–æ°´ < <span id="pot-val">80</span>% <input type="range" min="0" max="95" value="80" oninput="updateSettings(this.value, 'hp')" style="width:100%"></div>
            <div style="margin:10px 0;">å„ªå…ˆä½¿ç”¨:<select onchange="updateSettings(this.value, 'type')" style="background:#222; color:#fff; border:1px solid #555;"><option value="white">ç™½è‰²è—¥æ°´ (é«˜æ•ˆ)</option><option value="red">ç´…è‰²è—¥æ°´ (æ™®é€š)</option><option value="ultimate">çµ‚æ¥µè—¥æ°´ (æœ€å¼·)</option></select></div>
            <div style="margin:10px 0; border-top:1px solid #444; padding-top:10px;"><label style="color:#ff0; font-weight:bold; cursor:pointer;"><input type="checkbox" onchange="updateSettings(this.checked, 'show_range')"> é¡¯ç¤ºæ”»æ“Šå°„ç¨‹ (è¼”åŠ©åœˆ)</label></div>
            <div style="margin:10px 0; border-top:1px solid #444; padding-top:10px;">
                <button class="glass-btn" style="width:100%; margin-bottom:10px; border-color:#aa4; color:#ff8;" onclick="toggleWin('autosell')">ğŸ’° è‡ªå‹•è²©è³£ç®¡ç†</button>
                <div style="color:#da0">è‡ªå‹•æ–½æ³•/ç‹€æ…‹:</div>
                <label><input type="checkbox" onchange="updateSettings(this.checked, 'auto_haste')" id="cb_haste"> ç¶ è‰²è—¥æ°´</label>
                <label><input type="checkbox" onchange="updateSettings(this.checked, 'auto_brave')" id="cb_brave"> å‹‡/ç²¾/æ…</label>
                <label><input type="checkbox" onchange="updateSettings(this.checked, 'auto_blue')" id="cb_blue"> è—è‰²è—¥æ°´ (MP Buff)</label>
                <div style="margin:10px 0;">
                    è‡ªå‹•æ²»ç™’ (æ³•/å¦–):<br>
                    <!-- [Update] ä¿®æ”¹ç‚ºé€šç”¨æ²»ç™’è¡“é¸å–® -->
                    <select onchange="updateSettings(this.value, 'auto_heal_skill')" style="background:#222; color:#fff; width:100%; margin-bottom:5px;">
                        <option value="none">é—œé–‰</option>
                        <option value="heal_1">åˆç´šæ²»ç™’è¡“ (Lv.1)</option>
                        <option value="heal_2">ä¸­ç´šæ²»ç™’è¡“ (Lv.2)</option>
                        <option value="heal_3">é«˜ç´šæ²»ç™’è¡“ (Lv.3)</option>
                        <option value="e_heal">ç²¾éˆæ²»ç™’ (èˆŠç‰ˆç›¸å®¹)</option>
                    </select>
                    <br>HP < <input type="number" style="width:40px;background:#111;color:#fff;border:1px solid #444" value="60" onchange="updateSettings(this.value, 'auto_heal_val')">% ä¸” MP > <input type="number" style="width:40px;background:#111;color:#fff;border:1px solid #444" value="20" onchange="updateSettings(this.value, 'auto_heal_mp_limit')">%
                </div>
            </div>
            <div id="knight-settings" style="display:none; border-top:1px solid #444; margin-top:10px; padding-top:10px;">
                <div style="color:#ddd; font-weight:bold; margin-bottom:5px;">ğŸ›¡ï¸ é¨å£«å°ˆå±¬è¨­å®š:</div>
                <label style="display:block; font-size:11px;"><input type="checkbox" id="cb_auto_solid" onchange="updateSettings(this.checked, 'auto_solid_carriage')"> è‡ªå‹•å¢å¹…é˜²ç¦¦ (MP &gt; 15)</label>
                <label style="display:block; font-size:11px;"><input type="checkbox" id="cb_auto_counter" onchange="updateSettings(this.checked, 'auto_counter_barrier')"> è‡ªå‹•åæ“Šå±éšœ (MP &gt; 20)</label>
            </div>
            <div id="elf-settings" style="display:none; border-top:1px solid #444; margin-top:10px; padding-top:10px;">
                <div style="color:#adff2f; font-weight:bold; margin-bottom:5px;">ğŸ§ å¦–ç²¾å°ˆå±¬è¨­å®š:</div>
                <label><input type="checkbox" id="cb_auto_b2m" onchange="updateSettings(this.checked, 'auto_b2m')"> è‡ªå‹•é­‚é«”è½‰æ› (æ´—é­”)</label>
                <div style="font-size:12px; margin-top:5px;">HP > <input type="number" id="b2m-hp-input" value="80" style="width:35px;background:#111;color:#fff;border:1px solid #555" onchange="updateSettings(this.value, 'b2m_hp')">% ä¸” MP < <input type="number" id="b2m-mp-input" value="50" style="width:35px;background:#111;color:#fff;border:1px solid #555" onchange="updateSettings(this.value, 'b2m_mp')">% æ™‚ä½¿ç”¨</div>
                <div style="margin-top:10px; border-top:1px dashed #444; padding-top:5px;">
                    <div style="color:#adff2f; font-weight:bold; margin-bottom:5px;">ç‹€æ…‹/æ”»æ“Šé­”æ³•:</div>
                    <label style="display:block; font-size:11px;"><input type="checkbox" id="cb_auto_fire" onchange="updateSettings(this.checked, 'auto_fire')"> è‡ªå‹•çƒˆç‚æ­¦å™¨ (MP &gt; <input type="number" id="fire-mp-limit" value="30" style="width:30px;background:#111;color:#fff;border:1px solid #555" onchange="updateSettings(this.value, 'fire_mp_limit')">)</label>
                    <label style="display:block; font-size:11px;"><input type="checkbox" id="cb_auto_wind" onchange="updateSettings(this.checked, 'auto_wind')"> è‡ªå‹•é¢¨ä¹‹ç¥å°„ (MP &gt; <input type="number" id="wind-mp-limit" value="30" style="width:30px;background:#111;color:#fff;border:1px solid #555" onchange="updateSettings(this.value, 'wind_mp_limit')">)</label>
                    <label style="display:block; font-size:11px;"><input type="checkbox" id="cb_auto_storm" onchange="updateSettings(this.checked, 'auto_storm')"> è‡ªå‹•æš´é¢¨ç¥å°„ (MP &gt; <input type="number" id="storm-mp-limit" value="40" style="width:30px;background:#111;color:#fff;border:1px solid #555" onchange="updateSettings(this.value, 'storm_mp_limit')">)</label>
                </div>
            </div>
            <!-- æ–°å¢æ³•å¸«è¨­å®š -->
            <div id="mage-settings" style="display:none; border-top:1px solid #444; margin-top:10px; padding-top:10px;">
                <div style="color:#87ceeb; font-weight:bold; margin-bottom:5px;">ğŸ”® æ³•å¸«å°ˆå±¬è¨­å®š:</div>
                <label style="display:block; font-size:11px; margin-bottom:3px;">
                    <input type="checkbox" id="cb_auto_immune" onchange="updateSettings(this.checked, 'auto_immune_to_harm')"> 
                    è‡ªå‹•è–çµç•Œ (MP &gt; <input type="number" id="immune-mp-limit" value="60" style="width:30px;background:#111;color:#fff;border:1px solid #555" onchange="updateSettings(this.value, 'immune_mp_limit')">%)
                </label>
                <label style="display:block; font-size:11px;">
                    <input type="checkbox" id="cb_auto_soul" onchange="updateSettings(this.checked, 'auto_soul_elevation')"> 
                    è‡ªå‹•éˆé­‚æ˜‡è¯ (MP &gt; <input type="number" id="soul-mp-limit" value="80" style="width:30px;background:#111;color:#fff;border:1px solid #555" onchange="updateSettings(this.value, 'soul_mp_limit')">%)
                </label>
            </div>
        </div>
    </div>
    
    <div id="win-autosell" class="window glass-panel">
        <div class="win-head"><span>è‡ªå‹•è²©è³£ç®¡ç†</span><span class="win-close" onclick="toggleWin('autosell')">âœ•</span></div>
        <div class="win-body" id="autosell-list"></div>
        <div style="padding:10px; font-size:11px; color:#aaa; text-align:center;">å‹¾é¸çš„ç‰©å“åœ¨ç²å¾—æ™‚æœƒç›´æ¥è³£å‡ºæ›å–é‡‘å¹£<br>(ä¸æœƒä½”ç”¨èƒŒåŒ…ç©ºé–“)</div>
    </div>

    <div id="win-map" class="window glass-panel" style="width:640px; height:680px;">
        <div class="win-head"><span>ä¸–ç•Œåœ°åœ– (World Map)</span><span class="win-close" onclick="toggleWin('map')">âœ•</span></div>
        <div class="win-body" style="padding:0; text-align:center; position:relative;">
            <div id="map-container" style="margin:20px auto; border:2px solid #543; box-shadow: 0 0 20px #000; cursor:crosshair;">
                <canvas id="map-canvas" width="600" height="600"></canvas>
            </div>
            <div style="font-size:12px; color:#888;">é»æ“Šåœ°åœ–è‰²å¡Šé€²è¡Œå‚³é€</div>
        </div>
    </div>

    <div id="assign-modal" class="window glass-panel" style="width:300px; height:auto; z-index:1500; text-align:center;">
        <div class="win-head"><span>è¨­ç½®å¿«æ·éµ</span></div>
        <div class="win-body" style="display:flex; justify-content:center; gap:5px; flex-wrap:wrap; padding:20px;">
            <button class="glass-btn" onclick="bindHotkey(0)">1</button>
            <button class="glass-btn" onclick="bindHotkey(1)">2</button>
            <button class="glass-btn" onclick="bindHotkey(2)">3</button>
            <button class="glass-btn" onclick="bindHotkey(3)">4</button>
            <button class="glass-btn" onclick="bindHotkey(4)">5</button>
            <button class="glass-btn" onclick="bindHotkey(5)">6</button>
            <button class="glass-btn" onclick="bindHotkey(6)">7</button>
            <button class="glass-btn" onclick="bindHotkey(7)">8</button>
            <button class="glass-btn" onclick="bindHotkey(8)">9</button>
            <button class="glass-btn" onclick="bindHotkey(9)">0</button>
        </div>
    </div>
    
    <div id="teleport-menu" class="glass-panel" style="width:320px; padding:15px; display:none; z-index:2000; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);">
        <h3 style="color:#adf; margin:0 0 10px 0; border-bottom:1px solid #456; text-align:center;">ä¸–ç•Œåœ°åœ–å‚³é€</h3>
        <div id="tele-list" style="max-height:300px; overflow-y:auto;"></div>
        <button class="glass-btn" style="width:100%; margin-top:10px; border-color:#644;" onclick="closeTeleport()">é—œé–‰é¸å–®</button>
    </div>
</div>
<!-- Scripts Order: Data -> Assets -> UI -> Game -->
<script src="data.js"></script>
<script src="assets.js"></script>
<script src="ui.js"></script>
<script src="game.js"></script>
</body>
</html>